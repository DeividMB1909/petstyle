<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar SesiÃ³n - PetStyle</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/auth.css">
    <link rel="stylesheet" href="../css/components.css">
</head>
<body class="auth-body">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen hidden">
        <div class="loading-content">
            <div class="logo-loading">ğŸ¾</div>
            <h2>PetStyle</h2>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="auth-container">
        <!-- Header -->
        <div class="auth-header">
            <button class="back-btn" onclick="goBack()">
                <span class="back-icon">â†</span>
            </button>
            <div class="auth-logo">
                <span class="logo-icon">ğŸ¾</span>
                <span class="logo-text">PetStyle</span>
            </div>
        </div>

        <!-- Login Form -->
        <div class="auth-content">
            <div class="auth-welcome">
                <h1>Â¡Bienvenido de vuelta!</h1>
                <p>Inicia sesiÃ³n para acceder a tu cuenta y seguir explorando nuestros productos para mascotas</p>
            </div>

            <form id="login-form" class="auth-form" novalidate>
                <div class="form-group">
                    <label for="email" class="form-label">Correo ElectrÃ³nico</label>
                    <div class="input-group">
                        <span class="input-icon">ğŸ“§</span>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            class="form-input" 
                            placeholder="tu-email@ejemplo.com"
                            required
                            autocomplete="email"
                        >
                    </div>
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">ContraseÃ±a</label>
                    <div class="input-group">
                        <span class="input-icon">ğŸ”’</span>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            class="form-input" 
                            placeholder="Tu contraseÃ±a"
                            required
                            autocomplete="current-password"
                        >
                        <button type="button" class="toggle-password" tabindex="-1">ğŸ‘ï¸</button>
                    </div>
                </div>

                <div class="form-options">
                    <label class="checkbox-label">
                        <input type="checkbox" name="rememberMe" class="form-checkbox">
                        <span class="checkbox-text">Recordarme</span>
                    </label>
                    <a href="#" class="forgot-password" onclick="showForgotPassword()">
                        Â¿Olvidaste tu contraseÃ±a?
                    </a>
                </div>

                <button type="submit" class="btn-primary btn-auth">
                    <span class="btn-icon">ğŸš€</span>
                    <span class="btn-text">Iniciar SesiÃ³n</span>
                </button>

                <div class="auth-divider">
                    <span>o</span>
                </div>

                <button type="button" class="btn-secondary btn-auth" onclick="showDemoLogin()">
                    <span class="btn-icon">ğŸ‘¤</span>
                    <span class="btn-text">Cuenta Demo</span>
                </button>
            </form>

            <div class="auth-footer">
                <p class="auth-switch">
                    Â¿No tienes cuenta? 
                    <a href="register.html" class="auth-link">RegÃ­strate aquÃ­</a>
                </p>
            </div>
        </div>

        <!-- Demo Login Modal -->
        <div id="demo-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Cuentas Demo</h3>
                    <button class="close-btn" onclick="closeDemoModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="demo-info">Prueba la aplicaciÃ³n con estas cuentas de demostraciÃ³n:</p>
                    
                    <div class="demo-accounts">
                        <div class="demo-account" onclick="loginAsDemo('customer')">
                            <div class="demo-avatar">ğŸ‘¤</div>
                            <div class="demo-details">
                                <div class="demo-name">Usuario Cliente</div>
                                <div class="demo-email">juan@test.com</div>
                                <div class="demo-role">Cliente</div>
                            </div>
                            <button class="demo-btn">Usar Cuenta</button>
                        </div>
                        
                        <div class="demo-account" onclick="loginAsDemo('admin')">
                            <div class="demo-avatar">âš™ï¸</div>
                            <div class="demo-details">
                                <div class="demo-name">Administrador</div>
                                <div class="demo-email">admin@petstyle.com</div>
                                <div class="demo-role">Administrador</div>
                            </div>
                            <button class="demo-btn">Usar Cuenta</button>
                        </div>
                    </div>
                    
                    <div class="demo-warning">
                        <span class="warning-icon">âš ï¸</span>
                        <span>Los datos en cuentas demo son de prueba y pueden ser modificados por otros usuarios.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Forgot Password Modal -->
        <div id="forgot-password-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Recuperar ContraseÃ±a</h3>
                    <button class="close-btn" onclick="closeForgotPasswordModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="forgot-info">
                        Ingresa tu correo electrÃ³nico y te enviaremos las instrucciones para restablecer tu contraseÃ±a.
                    </p>
                    
                    <form id="forgot-password-form" class="forgot-form">
                        <div class="form-group">
                            <label for="forgot-email" class="form-label">Correo ElectrÃ³nico</label>
                            <div class="input-group">
                                <span class="input-icon">ğŸ“§</span>
                                <input 
                                    type="email" 
                                    id="forgot-email" 
                                    name="email" 
                                    class="form-input" 
                                    placeholder="tu-email@ejemplo.com"
                                    required
                                >
                            </div>
                        </div>
                        
                        <button type="submit" class="btn-primary">
                            <span class="btn-icon">ğŸ“¤</span>
                            <span class="btn-text">Enviar Instrucciones</span>
                        </button>
                    </form>
                    
                    <div class="forgot-note">
                        <span class="note-icon">ğŸ’¡</span>
                        <span>Si no recibes el correo en unos minutos, revisa tu carpeta de spam.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="../js/utils.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    
    <script>
        // Page-specific JavaScript
        
        // Check if already logged in
        document.addEventListener('DOMContentLoaded', async () => {
            const isAuthenticated = await Auth.checkAuthStatus();
            if (isAuthenticated) {
                // Redirect to main page if already logged in
                window.location.href = 'main.html';
                return;
            }
            
            // Auto-focus email field
            document.getElementById('email').focus();
            
            // Check for redirect parameter
            const redirectUrl = UrlUtils.getParam('redirect');
            if (redirectUrl) {
                Auth.setRedirectAfterLogin(decodeURIComponent(redirectUrl));
            }
        });

        // Navigation functions
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'main.html';
            }
        }

        // Demo login functions
        function showDemoLogin() {
            document.getElementById('demo-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeDemoModal() {
            document.getElementById('demo-modal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        async function loginAsDemo(type) {
            const demoCredentials = {
                customer: {
                    email: 'juan@test.com',
                    password: '123456'
                },
                admin: {
                    email: 'admin@petstyle.com',
                    password: 'admin123'
                }
            };

            const credentials = demoCredentials[type];
            if (!credentials) return;

            closeDemoModal();
            
            // Fill form
            document.getElementById('email').value = credentials.email;
            document.getElementById('password').value = credentials.password;
            
            // Auto-submit form
            setTimeout(() => {
                document.getElementById('login-form').dispatchEvent(new Event('submit'));
            }, 500);
        }

        // Forgot password functions
        function showForgotPassword() {
            document.getElementById('forgot-password-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Pre-fill email if entered
            const currentEmail = document.getElementById('email').value;
            if (currentEmail) {
                document.getElementById('forgot-email').value = currentEmail;
            }
        }

        function closeForgotPasswordModal() {
            document.getElementById('forgot-password-modal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Handle forgot password form
        document.getElementById('forgot-password-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const formData = FormUtils.getFormData(form);
            
            LoadingUtils.showButton(submitBtn, 'Enviando...');
            
            try {
                // Simulate API call (implement when backend is ready)
                await TimingUtils.delay(2000);
                
                Toast.show('Instrucciones enviadas a tu correo electrÃ³nico', 'success');
                closeForgotPasswordModal();
                form.reset();
            } catch (error) {
                Toast.show('Error al enviar instrucciones', 'error');
            } finally {
                LoadingUtils.hideButton(submitBtn);
            }
        });

        // Close modals when clicking backdrop
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                if (e.target.id === 'demo-modal') {
                    closeDemoModal();
                } else if (e.target.id === 'forgot-password-modal') {
                    closeForgotPasswordModal();
                }
            }
        });

        // Form enhancements
        document.addEventListener('input', (e) => {
            if (e.target.classList.contains('form-input')) {
                // Remove error styling when user starts typing
                e.target.classList.remove('error');
                const errorMsg = e.target.parentNode.nextElementSibling;
                if (errorMsg && errorMsg.classList.contains('error-message')) {
                    errorMsg.remove();
                }
            }
        });

        // Enter key handling for better UX
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.target.type === 'email') {
                // Move to password field when pressing Enter on email
                const passwordField = document.getElementById('password');
                if (passwordField) {
                    passwordField.focus();
                }
            }
        });

        // Handle browser autofill
        window.addEventListener('load', () => {
            // Check if browser autofilled the form
            const emailField = document.getElementById('email');
            const passwordField = document.getElementById('password');
            
            if (emailField.value && passwordField.value) {
                // Add visual indicator that form is autofilled
                [emailField, passwordField].forEach(field => {
                    field.classList.add('autofilled');
                });
            }
        });
    </script>
</body>
</html>