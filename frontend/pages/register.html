<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetStyle - Registro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/frontend/css/register.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="back-btn" onclick="goBack()">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            
            <div class="auth-header">
                <div class="logo">üêæ</div>
                <h1>Registro</h1>
                <p>Crea tu cuenta en PetStyle</p>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <form id="registerForm">
                <div class="form-group">
                    <label for="name" class="form-label">Nombre Completo</label>
                    <input 
                        type="text" 
                        id="name" 
                        class="form-input" 
                        placeholder="Tu nombre completo"
                        required
                        autocomplete="name"
                    >
                    <div class="form-error" id="nameError"></div>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">Correo Electr√≥nico</label>
                    <input 
                        type="email" 
                        id="email" 
                        class="form-input" 
                        placeholder="ejemplo@correo.com"
                        required
                        autocomplete="email"
                    >
                    <div class="form-error" id="emailError"></div>
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">Contrase√±a</label>
                    <input 
                        type="password" 
                        id="password" 
                        class="form-input" 
                        placeholder="M√≠nimo 6 caracteres"
                        required
                        autocomplete="new-password"
                    >
                    <div class="password-strength" id="passwordStrength"></div>
                    <div class="form-error" id="passwordError"></div>
                </div>

                <div class="form-group">
                    <label for="confirmPassword" class="form-label">Confirmar Contrase√±a</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        class="form-input" 
                        placeholder="Repite tu contrase√±a"
                        required
                        autocomplete="new-password"
                    >
                    <div class="form-error" id="confirmPasswordError"></div>
                </div>

                <div class="form-group">
                    <label for="phone" class="form-label">Tel√©fono (Opcional)</label>
                    <input 
                        type="tel" 
                        id="phone" 
                        class="form-input" 
                        placeholder="Tu n√∫mero de tel√©fono"
                        autocomplete="tel"
                    >
                    <div class="form-error" id="phoneError"></div>
                </div>

                <!-- T√©rminos y condiciones -->
                <div class="form-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="termsCheckbox" required>
                        <span class="checkmark"></span>
                        <span class="checkbox-text">
                            Acepto los <a href="#" onclick="showTerms()">T√©rminos y Condiciones</a> 
                            y la <a href="#" onclick="showPrivacy()">Pol√≠tica de Privacidad</a>
                        </span>
                    </label>
                    <div class="form-error" id="termsError"></div>
                </div>

                <button type="submit" class="btn-primary" id="registerBtn">
                    <span id="registerBtnText">Registrarse</span>
                    <div class="loading-spinner" id="registerSpinner" style="display: none;"></div>
                </button>
            </form>

            <div class="divider">
                <span>o conecta con</span>
            </div>

            <div class="social-buttons">
                <button class="social-btn google" onclick="registerWithGoogle()">
                    <svg class="social-icon" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Continuar con Google
                </button>

                <button class="social-btn facebook" onclick="registerWithFacebook()">
                    <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                    Continuar con Facebook
                </button>
            </div>

            <div class="auth-links">
                <p>¬øYa tienes una cuenta? <a href="login.html">Iniciar sesi√≥n</a></p>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal" style="display: none;">
        <div class="modal">
            <div class="modal-icon success">üéâ</div>
            <h3 class="modal-title">¬°Registro Exitoso!</h3>
            <p class="modal-text">Tu cuenta ha sido creada correctamente. Ahora puedes iniciar sesi√≥n.</p>
            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="goToLogin()">Iniciar Sesi√≥n</button>
            </div>
        </div>
    </div>

    <!-- Terms Modal -->
    <div class="modal-overlay" id="termsModal" style="display: none;">
        <div class="modal large">
            <div class="modal-header">
                <h3 class="modal-title">T√©rminos y Condiciones</h3>
                <button class="close-btn" onclick="closeModal('termsModal')">√ó</button>
            </div>
            <div class="modal-content">
                <div class="terms-content">
                    <h4>1. Aceptaci√≥n de los T√©rminos</h4>
                    <p>Al registrarte en PetStyle, aceptas estar sujeto a estos t√©rminos y condiciones.</p>
                    
                    <h4>2. Uso del Servicio</h4>
                    <p>PetStyle es una plataforma de comercio electr√≥nico dedicada a productos para mascotas.</p>
                    
                    <h4>3. Cuenta de Usuario</h4>
                    <p>Eres responsable de mantener la confidencialidad de tu cuenta y contrase√±a.</p>
                    
                    <h4>4. Privacidad</h4>
                    <p>Respetamos tu privacidad y protegemos tus datos personales seg√∫n nuestra pol√≠tica de privacidad.</p>
                    
                    <h4>5. Productos y Precios</h4>
                    <p>Los precios est√°n sujetos a cambios sin previo aviso. Las im√°genes son referenciales.</p>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal('termsModal')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div class="modal-overlay" id="privacyModal" style="display: none;">
        <div class="modal large">
            <div class="modal-header">
                <h3 class="modal-title">Pol√≠tica de Privacidad</h3>
                <button class="close-btn" onclick="closeModal('privacyModal')">√ó</button>
            </div>
            <div class="modal-content">
                <div class="terms-content">
                    <h4>1. Informaci√≥n que Recopilamos</h4>
                    <p>Recopilamos informaci√≥n que nos proporcionas directamente, como nombre, email y tel√©fono.</p>
                    
                    <h4>2. Uso de la Informaci√≥n</h4>
                    <p>Utilizamos tu informaci√≥n para proporcionar y mejorar nuestros servicios.</p>
                    
                    <h4>3. Compartir Informaci√≥n</h4>
                    <p>No vendemos ni compartimos tu informaci√≥n personal con terceros sin tu consentimiento.</p>
                    
                    <h4>4. Seguridad</h4>
                    <p>Implementamos medidas de seguridad para proteger tu informaci√≥n personal.</p>
                    
                    <h4>5. Contacto</h4>
                    <p>Si tienes preguntas sobre esta pol√≠tica, cont√°ctanos en privacy@petstyle.com</p>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal('privacyModal')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Social Login Modals -->
    <div class="modal-overlay" id="googleModal" style="display: none;">
        <div class="modal">
            <div class="modal-icon info">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                </svg>
            </div>
            <h3 class="modal-title">Continuar con Google</h3>
            <p class="modal-text">Esta funcionalidad estar√° disponible pr√≥ximamente.</p>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal('googleModal')">Cancelar</button>
                <button class="modal-btn primary" onclick="processGoogleRegister()">Entendido</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="facebookModal" style="display: none;">
        <div class="modal">
            <div class="modal-icon info">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
            </div>
            <h3 class="modal-title">Continuar con Facebook</h3>
            <p class="modal-text">Esta funcionalidad estar√° disponible pr√≥ximamente.</p>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal('facebookModal')">Cancelar</button>
                <button class="modal-btn primary" onclick="processFacebookRegister()">Entendido</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <!-- 1. API Connection -->
    <script src="/frontend/js/api.js"></script>
    
    <!-- 2. Register functionality -->
    <script>
        // ================================================
        // VARIABLES GLOBALES
        // ================================================
        let isRegistering = false;

        // ================================================
        // FUNCIONES DE REGISTRO CON API
        // ================================================
        async function performRegister(userData) {
            if (isRegistering) return;
            isRegistering = true;

            try {
                showRegisterLoading(true);
                
                console.log('üìù Intentando registro con:', userData.email);
                
                // Llamar al endpoint de registro de tu API
                const response = await apiRequest('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify(userData)
                });

                console.log('üì° Respuesta del servidor:', response);

                if (response.success) {
                    showRegisterLoading(false);
                    showSuccessModal();
                    
                    // Limpiar formulario
                    document.getElementById('registerForm').reset();
                    clearErrors();
                    
                } else {
                    throw new Error(response.message || 'Error al registrarse');
                }

            } catch (error) {
                showRegisterLoading(false);
                console.error('‚ùå Error en registro:', error);
                
                let errorMessage = 'Error al registrarse';
                
                if (error.message.includes('400')) {
                    errorMessage = 'Datos inv√°lidos';
                } else if (error.message.includes('409') || error.message.includes('duplicate')) {
                    errorMessage = 'Este email ya est√° registrado';
                    showFieldError('email', errorMessage);
                } else if (error.message.includes('500')) {
                    errorMessage = 'Error del servidor';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                showToast(errorMessage, 'error');
                
            } finally {
                isRegistering = false;
            }
        }

        // ================================================
        // VALIDACIONES
        // ================================================
        function validateForm() {
            clearErrors();
            let isValid = true;

            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const phone = document.getElementById('phone').value.trim();
            const termsAccepted = document.getElementById('termsCheckbox').checked;

            // Validar nombre
            if (!name) {
                showFieldError('name', 'El nombre es requerido');
                isValid = false;
            } else if (name.length < 2) {
                showFieldError('name', 'El nombre debe tener al menos 2 caracteres');
                isValid = false;
            }

            // Validar email
            if (!email) {
                showFieldError('email', 'El email es requerido');
                isValid = false;
            } else if (!isValidEmail(email)) {
                showFieldError('email', 'Email inv√°lido');
                isValid = false;
            }

            // Validar contrase√±a
            if (!password) {
                showFieldError('password', 'La contrase√±a es requerida');
                isValid = false;
            } else if (password.length < 6) {
                showFieldError('password', 'La contrase√±a debe tener al menos 6 caracteres');
                isValid = false;
            }

            // Validar confirmaci√≥n de contrase√±a
            if (!confirmPassword) {
                showFieldError('confirmPassword', 'Confirma tu contrase√±a');
                isValid = false;
            } else if (password !== confirmPassword) {
                showFieldError('confirmPassword', 'Las contrase√±as no coinciden');
                isValid = false;
            }

            // Validar tel√©fono (opcional pero si se proporciona debe ser v√°lido)
            if (phone && !isValidPhone(phone)) {
                showFieldError('phone', 'N√∫mero de tel√©fono inv√°lido');
                isValid = false;
            }

            // Validar t√©rminos y condiciones
            if (!termsAccepted) {
                showFieldError('terms', 'Debes aceptar los t√©rminos y condiciones');
                isValid = false;
            }

            return isValid;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function isValidPhone(phone) {
            // Acepta n√∫meros con espacios, guiones y par√©ntesis
            const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
            const cleanPhone = phone.replace(/[\s\-\(\)]/g, '');
            return phoneRegex.test(cleanPhone) && cleanPhone.length >= 10;
        }

        function checkPasswordStrength(password) {
            const strengthIndicator = document.getElementById('passwordStrength');
            let strength = 0;
            let strengthText = '';
            let strengthClass = '';

            if (password.length >= 6) strength++;
            if (password.match(/[a-z]/)) strength++;
            if (password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;

            switch (strength) {
                case 0:
                case 1:
                    strengthText = 'Muy d√©bil';
                    strengthClass = 'very-weak';
                    break;
                case 2:
                    strengthText = 'D√©bil';
                    strengthClass = 'weak';
                    break;
                case 3:
                    strengthText = 'Regular';
                    strengthClass = 'medium';
                    break;
                case 4:
                    strengthText = 'Fuerte';
                    strengthClass = 'strong';
                    break;
                case 5:
                    strengthText = 'Muy fuerte';
                    strengthClass = 'very-strong';
                    break;
            }

            strengthIndicator.textContent = password ? `Seguridad: ${strengthText}` : '';
            strengthIndicator.className = `password-strength ${strengthClass}`;
        }

        // ================================================
        // FUNCIONES DE UI
        // ================================================
        function showRegisterLoading(show) {
            const btn = document.getElementById('registerBtn');
            const btnText = document.getElementById('registerBtnText');
            const spinner = document.getElementById('registerSpinner');

            if (show) {
                btn.disabled = true;
                btnText.style.display = 'none';
                spinner.style.display = 'inline-block';
                btn.style.opacity = '0.7';
            } else {
                btn.disabled = false;
                btnText.style.display = 'inline';
                spinner.style.display = 'none';
                btn.style.opacity = '1';
            }
        }

        function showFieldError(fieldName, message) {
            const errorElement = document.getElementById(fieldName + 'Error');
            const inputElement = document.getElementById(fieldName);
            
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
            
            if (inputElement) {
                inputElement.classList.add('error');
            }
        }

        function clearErrors() {
            document.querySelectorAll('.form-error').forEach(error => {
                error.textContent = '';
                error.style.display = 'none';
            });
            
            document.querySelectorAll('.form-input').forEach(input => {
                input.classList.remove('error');
            });
        }

        function showSuccessModal() {
            document.getElementById('successModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()">√ó</button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        // ================================================
        // EVENT LISTENERS
        // ================================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìù P√°gina de registro cargada');

            // Verificar si ya est√° logueado
            if (isUserLoggedIn()) {
                console.log('üë§ Usuario ya logueado, redirigiendo...');
                window.location.href = 'main.html';
                return;
            }

            // Configurar formulario de registro
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    if (!validateForm()) {
                        return;
                    }

                    const userData = {
                        name: document.getElementById('name').value.trim(),
                        email: document.getElementById('email').value.trim(),
                        password: document.getElementById('password').value,
                        phone: document.getElementById('phone').value.trim()
                    };

                    await performRegister(userData);
                });
            }

            // Validaci√≥n en tiempo real de contrase√±a
            const passwordInput = document.getElementById('password');
            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    checkPasswordStrength(this.value);
                });
            }

            // Validaci√≥n de confirmaci√≥n de contrase√±a
            const confirmPasswordInput = document.getElementById('confirmPassword');
            if (confirmPasswordInput) {
                confirmPasswordInput.addEventListener('input', function() {
                    const password = document.getElementById('password').value;
                    if (this.value && this.value !== password) {
                        showFieldError('confirmPassword', 'Las contrase√±as no coinciden');
                    } else {
                        document.getElementById('confirmPasswordError').style.display = 'none';
                    }
                });
            }

            // Limpiar errores al escribir
            document.querySelectorAll('.form-input').forEach(input => {
                input.addEventListener('input', function() {
                    this.classList.remove('error');
                    const errorElement = document.getElementById(this.id + 'Error');
                    if (errorElement) {
                        errorElement.style.display = 'none';
                    }
                });
            });
        });

        // ================================================
        // FUNCIONES DE NAVEGACI√ìN
        // ================================================
        function isUserLoggedIn() {
            return localStorage.getItem('authToken') && localStorage.getItem('userId');
        }

        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'login.html';
            }
        }

        function goToLogin() {
            window.location.href = 'login.html';
        }

        function showTerms() {
            document.getElementById('termsModal').style.display = 'flex';
        }

        function showPrivacy() {
            document.getElementById('privacyModal').style.display = 'flex';
        }

        // ================================================
        // FUNCIONES DE SOCIAL REGISTER (PLACEHOLDERS)
        // ================================================
        function registerWithGoogle() {
            document.getElementById('googleModal').style.display = 'flex';
        }

        function registerWithFacebook() {
            document.getElementById('facebookModal').style.display = 'flex';
        }

        function processGoogleRegister() {
            showToast('Funcionalidad de Google pr√≥ximamente', 'info');
            closeModal('googleModal');
        }

        function processFacebookRegister() {
            showToast('Funcionalidad de Facebook pr√≥ximamente', 'info');
            closeModal('facebookModal');
        }

        console.log('‚úÖ Sistema de registro PetStyle cargado');
    </script>

    <!-- 3. Script original del registro (para compatibilidad) -->
      <script src="../js/api.js"></script>
    <script src="/frontend/js/register.js"></script>
</body>
</html>